<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard Recibo Sonrisas</title>

<style>
body {
    font-family: 'Segoe UI', Arial, sans-serif;
    background: linear-gradient(135deg,#eef2f7,#dbe6f6);
    margin:0;
    padding:20px;
}

.container {
    max-width:1200px;
    margin:auto;
}

h1 {
    text-align:center;
    margin-bottom:10px;
}

.smile {
    display:inline-block;
    animation: float 3s ease-in-out infinite;
    font-size:18px;
}

@keyframes float {
    0% { transform: translateY(0px); }
    50% { transform: translateY(-6px); }
    100% { transform: translateY(0px); }
}

.stats {
    display:grid;
    grid-template-columns: repeat(auto-fit,minmax(200px,1fr));
    gap:15px;
    margin:20px 0;
}

.card {
    background:white;
    padding:20px;
    border-radius:15px;
    box-shadow:0 8px 20px rgba(0,0,0,0.08);
    text-align:center;
}

.card h3 {
    margin:0;
    font-size:14px;
    color:#666;
}

.card p {
    font-size:24px;
    margin:10px 0 0 0;
    font-weight:bold;
}

.search-box input {
    width:100%;
    padding:12px;
    font-size:16px;
    border-radius:10px;
    border:1px solid #ccc;
}

table {
    width:100%;
    border-collapse:collapse;
    margin-top:20px;
    display:none;
    background:white;
    border-radius:15px;
    overflow:hidden;
    box-shadow:0 8px 20px rgba(0,0,0,0.08);
}

th, td {
    padding:12px;
    text-align:left;
    border-bottom:1px solid #eee;
    font-size:14px;
}

th { background:#f8f9fa; }

tr:hover { background:#f1f5ff; }

.no-results {
    margin-top:20px;
    text-align:center;
    display:none;
    font-weight:bold;
}
</style>
</head>

<body>

<div class="container">

<h1>Dashboard Recibo Sonrisas 
<span class="smile">ðŸ˜Š</span>
<span class="smile">ðŸ˜Š</span>
<span class="smile">ðŸ˜Š</span>
</h1>

<div class="stats">
    <div class="card">
        <h3>Total Registros</h3>
        <p id="totalRegistros">0</p>
    </div>
    <div class="card">
        <h3>Total Sonrisas</h3>
        <p id="totalValor">0</p>
    </div>
    <div class="card">
        <h3>Personas Impactadas</h3>
        <p id="totalPersonas">0</p>
    </div>
</div>

<div class="search-box">
<input type="text" id="searchInput" placeholder="Escribe el nombre para buscar...">
</div>

<table id="resultsTable">
<thead>
<tr>
<th>Fecha</th>
<th>Emisor</th>
<th>Receptor</th>
<th>Concepto</th>
<th>Valor</th>
<th>Estado</th>
</tr>
</thead>
<tbody></tbody>
</table>

<div class="no-results" id="noResults">No se encontraron resultados.</div>

</div>

<script>
let data = [];

fetch("data.json?v=" + new Date().getTime())
.then(res => res.json())
.then(json => {
    data = json;
    cargarEstadisticas();
});

function cargarEstadisticas() {
    document.getElementById("totalRegistros").innerText = data.length;

    let totalValor = 0;
    let personas = new Set();

    data.forEach(r => {
        totalValor += parseFloat(r.valor) || 0;
        personas.add(r.emisor);
        personas.add(r.receptor);
    });

    document.getElementById("totalValor").innerText = totalValor;
    document.getElementById("totalPersonas").innerText = personas.size;
}

const input = document.getElementById("searchInput");
const table = document.getElementById("resultsTable");
const tbody = table.querySelector("tbody");
const noResults = document.getElementById("noResults");

input.addEventListener("keyup", function() {

    const filter = input.value.toLowerCase();
    tbody.innerHTML = "";

    if (filter.length < 2) {
        table.style.display = "none";
        noResults.style.display = "none";
        return;
    }

    const filtered = data.filter(row =>
        row.emisor.toLowerCase().includes(filter) ||
        row.receptor.toLowerCase().includes(filter)
    );

    if (filtered.length === 0) {
        table.style.display = "none";
        noResults.style.display = "block";
        return;
    }

    noResults.style.display = "none";
    table.style.display = "table";

    filtered.forEach(row => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
            <td>${row.fecha}</td>
            <td>${row.emisor}</td>
            <td>${row.receptor}</td>
            <td>${row.concepto}</td>
            <td>${row.valor}</td>
            <td>${row.estado}</td>
        `;
        tbody.appendChild(tr);
    });
});
</script>

</body>
</html>
