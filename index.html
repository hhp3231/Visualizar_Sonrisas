<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ultra Dashboard Recibo Sonrisas</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{margin:0;font-family:'Segoe UI',sans-serif;background:linear-gradient(135deg,#e0f2ff,#f8fbff);overflow-x:hidden;}
.emoji{position:fixed;font-size:18px;animation:move 20s linear infinite;opacity:0.15;z-index:0;}
@keyframes move{
0%{transform:translate(0,0);}
25%{transform:translate(200px,-150px);}
50%{transform:translate(-150px,200px);}
75%{transform:translate(150px,150px);}
100%{transform:translate(0,0);}
}
.container{position:relative;z-index:2;max-width:1300px;margin:auto;padding:30px;}
h1{text-align:center;margin-bottom:20px;}

.stats{
display:grid;
grid-template-columns:180px 180px 180px 0.8fr; /* 20% mÃ¡s angosta */
gap:20px;
align-items:center;
}

.card{
backdrop-filter:blur(12px);
border:1px solid rgba(255,255,255,0.6);
border-radius:20px;
padding:20px;
display:flex;
flex-direction:column;
justify-content:center;
align-items:center;
text-align:center;
}

.card h3{margin:0;font-size:14px;}
.card p{font-size:30px;margin-top:10px;font-weight:bold;}

.grafica-card{
display:flex;
flex-direction:column;
align-items:center;
}

#graficaWrapper{
width:100%; /* ahora ocupa todo el ancho interno */
}

.search-box{margin-top:25px;}
.search-box input{width:100%;padding:12px;font-size:16px;border-radius:12px;border:1px solid #ccc;margin-bottom:10px;}

table{width:100%;border-collapse:collapse;margin-top:25px;display:none;}
th,td{padding:10px;border-bottom:1px solid #ddd;font-size:14px;}
th{text-align:left;}

.no-results{display:none;margin-top:15px;font-weight:bold;}

.ranking{margin-top:40px;}
.ranking table{display:table;}
</style>
</head>

<body>

<script>
for(let i=0;i<25;i++){
const e=document.createElement("div");
e.className="emoji";
e.innerText="ðŸ˜Š";
e.style.top=Math.random()*100+"vh";
e.style.left=Math.random()*100+"vw";
e.style.animationDuration=(15+Math.random()*20)+"s";
document.body.appendChild(e);
}
</script>

<div class="container">
<h1>Historial Sonrisas 2026 ðŸ˜Š</h1>

<div class="stats">
<div class="card"><h3>Total Registros</h3><p id="totalRegistros">0</p></div>
<div class="card"><h3>Total Sonrisas</h3><p id="totalValor">0</p></div>
<div class="card"><h3>Personas Impactadas</h3><p id="totalPersonas">0</p></div>

<div class="card grafica-card">
<h3>% Valores Organizacionales</h3>
<div id="graficaWrapper">
<canvas id="valoresChart" height="100"></canvas>
</div>
</div>
</div>

<div class="Nombre para filtar">
<h2>Ingresa tu nombre para consultar historial</h2>  

<div class="search-box">
<input type="text" id="filterEmisor" placeholder="Filtrar por quien Da Sonrisas...">
<input type="text" id="filterReceptor" placeholder="Filtrar por quien Recibe Sonrisas...">
</div>

<table id="resultsTable">
<thead>
<tr><th>Fecha</th><th>Da Sonrisas</th><th>Recibe Sonrisas</th><th>Valor Organizacional</th><th>Valor</th><th>Estado</th></tr>
</thead>
<tbody></tbody>
</table>

<div class="no-results" id="noResults">No se encontraron resultados.</div>

<div class="ranking">
<h2>Ranking Top Personas con mÃ¡s Sonrisas Recibidas</h2>
<table>
<thead><tr><th>#</th><th>Nombre</th><th>Total Sonrisas</th></tr></thead>
<tbody id="rankingBody"></tbody>
</table>
</div>

</div>

<script>
let data=[];
let rankingGlobal={};
let chart;

fetch("data.json?v="+new Date().getTime())
.then(res=>res.json())
.then(json=>{
data=json;
construirRankingGlobal();
actualizarDashboard(data);
});

function construirRankingGlobal(){
rankingGlobal={};
data.forEach(r=>{
let valor=parseFloat(r.valor)||0;
if(!rankingGlobal[r.receptor]) rankingGlobal[r.receptor]=0;
rankingGlobal[r.receptor]+=valor;
});
actualizarRanking(rankingGlobal);
}

function actualizarDashboard(dataset){
document.getElementById("totalRegistros").innerText=dataset.length;

let totalValor=0;
let personas=new Set();
let valoresMap={};

dataset.forEach(r=>{
let valor=parseFloat(r.valor)||0;
totalValor+=valor;
personas.add(r.emisor);
personas.add(r.receptor);

if(!valoresMap[r.concepto]) valoresMap[r.concepto]=0;
valoresMap[r.concepto]+=valor;
});

document.getElementById("totalValor").innerText=totalValor;
document.getElementById("totalPersonas").innerText=personas.size;

actualizarGrafico(valoresMap);
}

function actualizarRanking(map){
let arr=Object.entries(map).sort((a,b)=>b[1]-a[1]).slice(0,10);
const tbody=document.getElementById("rankingBody");
tbody.innerHTML="";
arr.forEach((item,i)=>{
tbody.innerHTML+=`<tr><td>${i+1}</td><td>${item[0]}</td><td>${item[1]}</td></tr>`;
});
}

function actualizarGrafico(valoresMap){
const ctx=document.getElementById('valoresChart').getContext('2d');

delete valoresMap["Valor Organizacional"];

let labels=Object.keys(valoresMap);
let values=Object.values(valoresMap);
let total=values.reduce((a,b)=>a+b,0);

if(chart) chart.destroy();

let datasets = labels.map((label,i)=>({
label:label,
data:[values[i]],
backgroundColor:[
'#4facfe','#43e97b','#fa709a','#f6d365',
'#a18cd1','#30cfd0','#f093fb'
][i%7]
}));

chart=new Chart(ctx,{
type:'bar',
data:{
labels:["DistribuciÃ³n"],
datasets:datasets
},
options:{
indexAxis:'y',
responsive:true,
animation:{duration:1000},
plugins:{
legend:{position:'bottom'},
tooltip:{
callbacks:{
label:function(context){
let value=context.raw;
let percentage=((value/total)*100).toFixed(1);
return context.dataset.label+": "+percentage+"%";
}
}
}
},
scales:{
x:{stacked:true,max:total,display:false},
y:{stacked:true,display:false}
}
}
});
}

const filterEmisor=document.getElementById("filterEmisor");
const filterReceptor=document.getElementById("filterReceptor");
const table=document.getElementById("resultsTable");
const tbody=table.querySelector("tbody");
const noResults=document.getElementById("noResults");

function aplicarFiltros(){
let emisorFiltro=filterEmisor.value.toLowerCase();
let receptorFiltro=filterReceptor.value.toLowerCase();

tbody.innerHTML="";

let filtered=data.filter(r=>{
let cumpleEmisor=emisorFiltro==="" || r.emisor.toLowerCase().includes(emisorFiltro);
let cumpleReceptor=receptorFiltro==="" || r.receptor.toLowerCase().includes(receptorFiltro);
return cumpleEmisor && cumpleReceptor;
});

if(emisorFiltro==="" && receptorFiltro===""){
table.style.display="none";
noResults.style.display="none";
actualizarDashboard(data);
return;
}

if(filtered.length===0){
table.style.display="none";
noResults.style.display="block";
actualizarDashboard([]);
return;
}

table.style.display="table";
noResults.style.display="none";

filtered.forEach(r=>{
tbody.innerHTML+=`<tr><td>${r.fecha}</td><td>${r.emisor}</td><td>${r.receptor}</td><td>${r.concepto}</td><td>${r.valor}</td><td>${r.estado}</td></tr>`;
});

actualizarDashboard(filtered);
}

filterEmisor.addEventListener("keyup",aplicarFiltros);
filterReceptor.addEventListener("keyup",aplicarFiltros);
</script>

</body>
</html>



